<head>
    <link href="http://vjs.zencdn.net/4.12/video-js.css" rel="stylesheet">
    <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>

    <script src="video.dev.js"></script>
    <script src="videojs-media-sources.js"></script>
    <script src="videojs.hls.min.js"></script>
    <style>
      .video-js {
        width: 100% !important;
        height: 100% !important;
      }
      .vjs-default-skin.vjs-paused .vjs-big-play-button
      {
        display: none;
      }
      body {
        background-color: black;
      }
    </style>
</head>

<body>
  <div id="video-container" >
  <div id="myvideo_videojs1" >
  <video id="my-video" class="video-js vjs-default-skin" controls preload="auto" >
    <p class="vjs-no-js">
      To view this video please enable JavaScript, and consider upgrading to a web browser that
    <a href="http://videojs.com/html5-video-support/" target="_blank">supports HTML5 video</a>
    </p>
  </video>
  </div>
  </div>

  <script>
    var myPlayer = videojs('my-video');

    var transcodeAndRun = function() {
      var filename = $.getUrlVar('filename');
      var fileIndex = $.getUrlVar('fileId');

      $.ajax({
        url: 'http://localhost:3000/media/' + filename,
        type: 'GET',
        success: function(data, textStatus, jqXHR) {
          console.log(data.backdrop_path );
          myPlayer.poster(data.backdrop_path);
        }
      });

      if (!fileIndex) {
        fileIndex = 0;
      }
      var url = 'http://localhost:3000/media/' + filename + '/file/' + fileIndex + '/transcode';

      $.ajax({
        url: url,
        type: 'POST',
        success: function(data, textStatus, jqXHR) {
          // give 10 seconds to buffer
          setTimeout(function() {
            console.log("http://localhost:3000/" + data);
            myPlayer.src({"src": "http://localhost:3000/" + data, "type":"application/x-mpegURL"});
            //myPlayer.src({"src": "//s3.amazonaws.com/_bc_dml/example-content/tears-of-steel/playlist.m3u8", "type":"application/x-mpegURL"});
            myPlayer.currentTime(0);
            myPlayer.play();
          }, 30000);
        }
      });
    };

    myPlayer.ready(function() {
      $.extend({
        getUrlVars: function(){
          var vars = [], hash;
          var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
          for(var i = 0; i < hashes.length; i++) {
            hash = hashes[i].split('=');
            vars.push(hash[0]);
            vars[hash[0]] = hash[1];
          }
          return vars;
        },
        getUrlVar: function(name){
          return $.getUrlVars()[name];
        }
      });
      transcodeAndRun();
    });
  </script>
</body>
